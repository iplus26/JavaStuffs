# Java 实验 - 音乐播放器
## 安装使用说明


1. 将音乐文件放置在软件的同目录下。
2. 打开软件，软件会显示获取到的音乐（目前只有同目录下的音乐可以正常播放）
3. 目前软件实现的功能有：
	* 播放
	* 暂停
	* 停止
	* 下一首
	* 获取歌曲的名称、作者和专辑
	* 根据作者名字的第一个字显示图片（目前只有英文字母 C, H, J, T, U 可以显示，比如说 Jason, Tom 或者 Unknown；如果是其他字母和中文名字则会显示笑脸）
	
## 心路历程

首先我先熟悉了一下第三方库的使用，我本身是习惯用 TextMate & CodeRunner 等轻量的文本编辑器来写我学过的所有语言的代码的，但是这次因为包含了第三方库 JLayer & JID 所以 CodeRunner 并不能直接运行我的代码。我在网上搜索了一些方法，尝试使 CodeRunner 能够直接 `Command + R` 运行我的代码但是未遂，所以我还是用 Eclipse 来进行了代码的开发，经过这次开发我觉得 Eclipse 作为 IDE 确实有很多比其他的代码编写器更强大的功能，但是自动补全功能其实是不如 CodeRunner 用起来舒服的，所以我中途还是用 CodeRunner 写了几段代码的。

学会了 JLayer 的基本用法之后，我开始编写播放器的图形界面。因为有一段时间没有写 Java 了，我还是参照之前计算器和记事本的代码找回来一些印象。这次对于 Java GUI 的一个新的认识是发现了 FlowLayout 或者是 BorderLayout 等等都用起来不是很顺手，因为他们本质上都是一个流的形式来布置组件的，比如我拉动窗口的大小，位置可能就会发生变化。但是我并不希望我的播放器是这样的，所以我用 `setResizable(false);` 和 `setLocationRelativeTo(null);` 两个语句来限制我的窗口不可以被 resize，打开的时候默认屏幕居中。然后我并没有使用任何一种 Layout 布局（`setLayout(null);`）并且使用各个组件的 `setBounds(int x, int y, int width, int height)` 方法来具体设置它们的位置和大小。这是我之前在 Java GUI 编程上面没有尝试过的。

通过这次实验，我对线程有了更深入的理解。比如我用一个 `Thread` 的子类 `PlayThread` 来表达播放线程，子类 `PauseThread` 来表达暂停线程。而停止功能我就没有写一个新的线程，而是直接把 `PlayThread` 停掉了。我不知道这是不是一个推荐的方案，但是我觉得可能实现是更重要的一件事 :)

我本来是想要在播放歌曲的时候显示专辑图片，但是似乎 JID 没法儿获取专辑图片的信息，所以我干脆想了一个法子，不显示图片，而是用标签之类的组建“拼凑”出一个图片。根据歌曲作者的首字母显示一个“像素风格”的图片，比如说 Jason 的首字母 J，就用随机的色块拼出来一个“J”。我觉得画26个字母太无聊了，就画了简单的几个意思一下，其他的字母和中文会显示一个笑脸 :)（所以目前只有字母 C, H, J, T, U 可以显示，比如说 Jason, Tom 或者 Unknown，老师要是感兴趣的话可以自己加上其他的然后发给我）。我觉得还是挺有意思的，另外 Java 的 Color 类里的颜色丑的好可爱。

在实现暂停功能的时候，我经历了一些步骤：

1. 我一开始想着可以对播放线程“动一些手脚”，让它暂停一下，就像我将播放线程终止实现暂停一样。但是后来发现好像没有一个可以从外部使线程停下来的方法。
2. 后来我又想 JLayer 库里是不是存在一种 `getPosition()` 方法，获取到目前播放的位置，重新播放的时候再从这个 position 继续。和室友研究了一下发现 Player 类里面确实有一个 `getPosition()` 方法，但是在 AdvancedPlayer 类里面才有从某个地方开始播放的功能，但又没有 `getPosition()` 方法，也就是应该只能暂停再播放一次。我觉得这个方案失败可能是我没有好好学习 JLayer 库，应该是有一个解决方案的吧。
3. 老师讲的是一帧一帧地播放，但是这样做其实是一帧一帧地卡，我也不知道为什么。
4. 最后我从 FileStream 下手，上网查到了 `available()` 和 `skip()` 方法，从而如代码所示实现了暂停和再播放。

实现获取歌曲的信息的功能是使用了 JID3 库。一开始用的是 Mp3Fenge 库，但是它老是报一堆红字出来，所以后来换成 JID3。JID3 看起来很复杂，光是 tag 就分了好几个版本，我就干脆直接用了它官网的 sample code，不求甚解地改了一下用上了（就是我的 Song 类）。
